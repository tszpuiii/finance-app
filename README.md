# Personal Finance Manager (COMP4342)

A cross-platform personal finance management mobile application for Android/iOS with cloud backend, budget tracking, GPS location, biometric authentication, offline sync, and local notifications. This repository fulfills the COMP4342 Mobile Computing course requirements: runs on real devices/emulators with cloud API (Node/Express + MongoDB).

## Features

- **Authentication**: Login/Register with JWT. Biometric authentication (Face ID/Touch ID/Fingerprint) enabled after first successful login
- **Expense Management**: Add expenses with GPS location reverse geocoding and category inference, delete, edit, search, and view details
- **Dashboard**: Category pie chart, recent expense list, pull-to-refresh, total budget overview
- **Budget Management**: Set monthly budgets for ALL/categories (Food, Transport, etc.), view current month status with progress bars
- **Insights**: Daily expense trends, category statistics, total spent vs budget with visualizations
- **Calendar View**: Monthly calendar with daily spending intensity color-coding
- **Offline Support**: Queue expenses when offline, auto-sync when back online
- **Settings**: Language selection (English/Traditional Chinese/Simplified Chinese), dark/light mode toggle, account info, logout
- **Receipt Photos**: Optional receipt photo capture for expense records
- **Mock Mode**: UI preview without backend or emulator using web browser

## Tech Stack

- **Frontend**: Expo React Native (Navigation, expo-local-authentication, expo-location, victory-native, expo-notifications, expo-image-picker)
- **Backend**: Node.js + Express + Mongoose (MongoDB local/Atlas), JWT, CORS, body-parser
- **State Management**: React Context (Theme, Language)
- **Charts**: Victory Native (VictoryChart, VictoryLine, VictoryBar, VictoryPie)

## Project Structure

```
finance-app/
├─ client/              # Expo React Native app
│  ├─ screens/          # Screen components
│  ├─ components/       # Reusable components
│  ├─ contexts/         # React Context providers
│  ├─ services/         # API service functions
│  └─ utils/            # Utility functions
└─ server/              # Node/Express API
   ├─ controllers/      # Request handlers
   ├─ models/           # Mongoose schemas
   └─ routes/           # API routes
```

## Prerequisites

### Required Software

#### MongoDB Desktop
1. Download MongoDB Desktop (MongoDB Compass):
   - Visit: https://www.mongodb.com/try/download/compass
   - Download and install for your system (Windows/Mac/Linux)
2. After installation, launch MongoDB Desktop
3. Ensure MongoDB service is running (default port: 27017)

#### Android Studio
1. Download Android Studio:
   - Visit: https://developer.android.com/studio
   - Download and install Android Studio
2. Install Android SDK:
   - Open Android Studio
   - Go to Settings/Preferences → Appearance & Behavior → System Settings → Android SDK
   - Ensure Android SDK Platform and Android SDK Build-Tools are installed
3. Create Android Virtual Device (AVD):
   - Open Android Studio
   - Click Tools → Device Manager
   - Click "Create Device"
   - Select device model (recommended: Pixel 5 or Pixel 6)
   - Select system image (recommended: API 33 or higher)
   - Complete setup and launch emulator

#### Node.js
1. Download Node.js (version 18 or higher):
   - Visit: https://nodejs.org/
   - Download and install LTS version

#### Expo Go (for real device testing)
1. Install Expo Go on your phone:
   - iOS: Download "Expo Go" from App Store
   - Android: Download "Expo Go" from Google Play

### Get Local IP Address (for real device testing)

#### Windows
```powershell
Get-NetIPAddress -AddressFamily IPv4 | Where-Object {$_.InterfaceAlias -notlike "*Loopback*"} | Select-Object IPAddress, InterfaceAlias
```
Find your Wi-Fi or Ethernet adapter IP address (e.g., 192.168.1.10)

#### Mac/Linux
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```
or
```bash
ip addr show | grep "inet " | grep -v 127.0.0.1
```

## Quick Start

### Step 1: Clone Repository
```bash
git clone <repository-url>
cd finance-app
```

### Step 2: Setup Backend Server

```powershell
cd server
npm install
```

Create `.env` file (if it doesn't exist):
```powershell
Copy-Item env.example .env
```

The `.env` file is automatically configured with:
```
PORT=3000
MONGODB_URI=mongodb://localhost:27017/finance-app
JWT_SECRET=<auto-generated random string>
```

**Using MongoDB Atlas (Cloud)**: Edit `server/.env` and change `MONGODB_URI` to your Atlas connection string.

### Step 3: Setup Frontend

```powershell
cd client
npm install
```

### Step 4: Start Application

#### Option A: Android Emulator (Recommended)

**Terminal 1 - Start Backend Server:**
```powershell
cd server
npm start
```
You should see:
```
Server running on port 3000
✓ Connected to MongoDB
```

**Terminal 2 - Start Frontend Dev Server:**
```powershell
cd client
$env:EXPO_PUBLIC_API_URL="http://10.0.2.2:3000/api"
npm start
```

**In Expo Dev Server Terminal:**
- Press `a` - Open app in Android emulator
- Press `r` - Reload app
- Press `m` - Toggle menu

**Note**: `10.0.2.2` is the special address for Android emulator to access host localhost.

#### Option B: Real Device (iPhone/Android)

**Step 1: Get Local IP Address**
- Windows: `Get-NetIPAddress -AddressFamily IPv4 | Where-Object {$_.InterfaceAlias -notlike "*Loopback*"}`
- Mac/Linux: `ifconfig | grep "inet " | grep -v 127.0.0.1`

**Step 2: Start Backend Server (Terminal 1)**
```powershell
cd server
npm start
```

**Step 3: Start Frontend Dev Server (Terminal 2)**
```powershell
cd client
$env:EXPO_PUBLIC_API_URL="http://YOUR_IP:3000/api"
npm start
```
Replace `YOUR_IP` with the IP address from Step 1 (e.g., `192.168.1.10`)

**Step 4: Connect on Phone**
- Ensure phone and computer are on the same Wi-Fi network
- Open Expo Go app
- Scan the QR code shown in terminal
- Or use camera app to scan QR code, then tap notification to open Expo Go

**If connection fails, use tunnel mode:**
```powershell
npx expo start --tunnel
```
(Slower but works across different networks)

#### Option C: Web Mode (UI Preview Only)

```powershell
cd client
$env:EXPO_PUBLIC_API_URL="mock"
npm run web
```

Mock mode intercepts API calls and returns fake data, useful for quick UI and flow validation.

## Service Status Check

### Check Backend Server
Open in browser: `http://localhost:3000/health`
Should see: `{"status":"ok"}`

### Check MongoDB
```powershell
# Windows PowerShell
Test-NetConnection -ComputerName localhost -Port 27017

# Mac/Linux
nc -zv localhost 27017
```

## User Manual

### Getting Started

1. **Register/Login**
   - Tap "No account? Register" to create a new account
   - Enter email and password
   - After first successful login, biometric authentication (Face ID/Touch ID) will be automatically enabled if available
   - On subsequent logins, you can use biometric authentication or email/password

2. **Dashboard (Home)**
   - View total spent and monthly spending summary
   - See total budget overview with progress bar
   - Quick actions: Add Expense, Currency Settings, Budget Settings
   - View expense by category pie chart
   - Scroll to see recent expenses list
   - Pull down to refresh and sync offline expenses

3. **Add Expense**
   - Tap the "+" button in navigation bar or "Add Expense" on Dashboard
   - Enter amount, select category, add optional note
   - App automatically detects your location (if permission granted)
   - Optionally take a photo of receipt
   - Tap "Save" to record expense
   - Expenses are queued if offline and synced when back online

4. **View Expense Details**
   - Tap any expense in the recent list
   - View full details: amount, category, date, location, note, receipt photo
   - Edit or delete expense from detail screen

5. **Edit Expense**
   - From expense detail screen, tap "Edit Expense"
   - Modify amount, category, note, or receipt photo
   - Tap "Save" to update

6. **Calendar View**
   - Tap calendar icon in navigation bar
   - View monthly calendar with color-coded spending intensity
   - Tap any date to see daily expense list
   - Swipe left/right to change months
   - Colors indicate spending intensity based on your budget

7. **Budget Management**
   - Tap "Budget" from Dashboard quick actions or navigation bar
   - Set overall monthly budget
   - Set category-specific budgets (Food, Transport, etc.)
   - Add custom categories
   - Remove categories (ALL category cannot be removed)
   - Progress bars show current spending vs budget
   - Auto-saves 1 second after input changes

8. **Insights**
   - Tap insights icon in navigation bar
   - View total spent vs total budget with large progress bar
   - See average daily spending
   - View top expense categories with percentage bars
   - View daily expense trend chart
   - All data is for current month

9. **Settings**
   - Tap settings icon in navigation bar
   - **Language**: Switch between English, Traditional Chinese, Simplified Chinese (no restart required)
   - **Dark Mode**: Toggle between light and dark theme
   - **Account Info**: View email, user ID, member since date
   - **Logout**: Log out and return to login screen

10. **Currency Settings**
    - Access from Dashboard quick actions
    - Select your preferred currency
    - Currency is displayed throughout the app

### Tips

- **Offline Mode**: You can add expenses when offline. They will be automatically synced when you return to Dashboard and have internet connection.
- **Location**: Grant location permission for automatic location detection when adding expenses. Location is used for category inference.
- **Receipt Photos**: Taking photos is optional. Photos are compressed to save storage space.
- **Biometric Login**: After first login, Face ID/Touch ID will be available. Tap the biometric button below the login button to use it.
- **Dark Mode**: All screens support dark mode. Toggle in Settings.
- **Search**: On Dashboard, use the search bar to find expenses by category, note, or amount.

## Common Scripts

- **Server**: `npm run dev` (start with nodemon)
- **Client**: `npm start`, `npm run android`, `npm run web`

## Troubleshooting

### Port Already in Use
If port 3000 or 8081 is occupied:
- Stop the process using the port
- Or modify `PORT` setting in `server/.env`

### App Keeps Loading
1. Check if backend server is running
2. Check if API URL is correctly set
3. Clear cache: `npx expo start --clear`

### Cannot Connect to Backend
- **Android Emulator**: Use `10.0.2.2:3000`
- **Real Device**: Use computer's IP address (ensure same Wi-Fi network)
- Ensure backend server is running
- Check if firewall is blocking port 3000

### Notifications/Location Permissions
- Go to system settings to allow app permissions
- In Android emulator, location services may not be available (emulator limitation)

### iPhone Dynamic Island Overlap
- App automatically handles safe area, content won't be blocked by dynamic island

### Face ID Not Working in Expo Go
- Face ID requires development build. Expo Go doesn't support Face ID due to native module limitations.
- The code is fully implemented and will work in development build or production build.
- For testing, use email/password login in Expo Go.

### Biometric Authentication Shows "Login Required"
- Make sure you've logged in with email/password at least once
- After first login, biometric authentication is automatically enabled
- If still not working, try logging out and logging in again

## API Documentation

The backend provides RESTful API endpoints for:
- Authentication: `/api/auth/register`, `/api/auth/login`, `/api/auth/me`
- Expenses: `/api/expenses` (GET, POST), `/api/expenses/:id` (GET, PUT, DELETE)
- Budgets: `/api/budgets` (GET, POST, PUT, DELETE), `/api/budgets/status` (GET)

For detailed API documentation, see `API_DOCUMENTATION.md` (if available).

## References

- Expo (React Native): https://docs.expo.dev/
- MongoDB Local Setup: `server/MONGODB_SETUP.md`
- MongoDB Atlas: https://www.mongodb.com/atlas/database
- Android Studio: https://developer.android.com/studio
- Victory Native Charts: https://formidable.com/open-source/victory/docs/native/

---

For complete course-oriented setup and development guide, see `docs/COMP4342_Guide.md` (if available).
